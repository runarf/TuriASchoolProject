<% content_for :page_title do %>
    "Discussion"
<% end %>

<div class="widget">
  <div class="widget-content widget-content-mini themed-background-dark text-light-op">
    <span class="pull-right text-muted"><%= distance_of_time_in_words (Time.now - @discussion.created_at) %></span>
    <%= link_to user_path(@discussion.user.id), class: 'text-light' do %>
        <strong>&lt;<%= @discussion.user.name %>&gt;</strong>
    <% end %>
  </div>
  <div class="widget-content">
    <h3><%= @discussion.title %></h3>

    <p><%= simple_format @discussion.body %></p>
  </div>
  <div class="widget-content themed-background-muted">
    <ul class="media-list push" , id="comment-list">
      <% if @comments.exists? %>
          <%= render partial: "comments/comment", collection: @comments.select(&:persisted?) %>
      <% end %>
    </ul>
    <ul class="media-list push">
      <li class="media">
        <%= link_to image_tag(current_user.gravatar_url, class: 'img-circle', alt: 'Avatar'),
                    user_path(current_user),
                    class: 'pull-left'
        %>
        <div class="media-body">
          <%= form_for [@trip, @discussion, @comment], remote: true, id: 'new_comment' do |f| %>
              <%= f.text_area :body, placeholder: 'Write your comment..', rows: '2', class: 'form-control' %>
              <%= f.submit "Publish", class: 'btn btn-effect-ripple btn-sm btn-primary', style: 'overflow: hidden; position: relative;' %>
          <% end %>
        </div>
      </li>
    </ul>
  </div>
</div>

<div class="block overflow-hidden">
  <div class="block-section animation-fadeInQuick2" id="message-view">
    <!-- Title -->
    <div class="block-title clearfix">
      <div class="block-options pull-right">
        <%= link_to raw('<i class="fa fa-pencil"></i>'),
                    edit_trip_discussion_path(@trip, @discussion),
                    id: 'edit-discussion-btn',
                    style: 'overflow: hidden; position: relative',
                    class: 'btn btn-effect-ripple btn-warning',
                    data: {toggle: 'tooltip', original_title: 'Edit'}
        %>

        <%= link_to raw('<i class="fa fa-trash"></i>'),
                    trip_discussion_path(@trip, @discussion),
                    method: :delete,
                    data: {
                            confirm: "Are you sure you want to delete this discussion?",
                            toggle: 'tooltip',
                            original_title: 'Delete'
                    },
                    title: '',
                    id: 'destroy-discussion-btn',
                    class: 'btn btn-effect-ripple btn-danger',
                    style: 'overflow: hidden; position: relative;' %>
      </div>
      <div class="block-options pull-left">
        <%= link_to :back,
                    id: 'discussion-view-back',
                    class: 'btn btn-effect-ripple btn-default',
                    style: 'overflow: hidden; position: relative;' do %>
            <i class="fa fa-chevron-left"></i>
            Back to Discussions
        <% end %>
      </div>
    </div>
    <!-- END Title -->
  </div>
</div>
